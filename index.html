<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Webhook Spammer</title>
  <style>
    /* 全体 */
body {
  background-color: #121212;
  color: #00ff99;
  font-family: "Courier New", monospace;
  padding: 10px;
  margin: 0;
  font-size: 16px;
}

/* フォームフィールド */
fieldset {
  border: 1px solid #00ff99;
  margin-bottom: 15px;
  padding: 12px;
  border-radius: 8px;
}

legend {
  color: #00ff99;
  font-weight: bold;
  font-size: 18px;
}

/* 入力欄 */
input, textarea, select {
  background: #1a1a1a;
  color: #00ff99;
  border: 1px solid #00ff99;
  padding: 12px;
  width: 100%;
  margin-bottom: 12px;
  font-size: 16px;
  border-radius: 6px;
  box-sizing: border-box;
}

/* ボタン */
button {
  background: #1a1a1a;
  color: #00ff99;
  border: 1px solid #00ff99;
  padding: 14px;
  width: 100%;
  margin-bottom: 12px;
  cursor: pointer;
  font-size: 18px;
  border-radius: 6px;
  transition: 0.2s;
}

button:hover {
  box-shadow: 0 0 12px #00ff99;
}

/* ログ */
#log {
  background: #000;
  border: 1px solid #00ff99;
  padding: 10px;
  height: 250px;
  overflow-y: auto;
  white-space: pre-wrap;
  font-size: 14px;
  border-radius: 6px;
}

/* メディアクエリ: スマホ用調整 */
@media (max-width: 480px) {
  body {
    padding: 8px;
    font-size: 15px;
  }
  legend {
    font-size: 16px;
  }
  input, textarea, select {
    padding: 14px;
    font-size: 16px;
  }
  button {
    padding: 16px;
    font-size: 18px;
  }
  #log {
    height: 200px;
    font-size: 14px;
  }
}
  </style>
</head>
<body>
  <h1>Webhook Spammer</h1>
  <form id="form">
    <fieldset>
      <input type="text" id="token" placeholder="Bot Token" required>
      <input type="text" id="guildId" placeholder="サーバーID" required>
      <input type="text" id="webhookName" placeholder="Webhook名" required>
      <textarea id="message" rows="3" placeholder="送信するメッセージ" required></textarea>
      <label>送信回数: <input type="number" id="count" min="1" value="1"></label>
      <label>送信間隔(ms): <input type="number" id="interval" min="100" value="1000"></label>
    </fieldset>
    <button type="submit">開始</button>
    <button type="button" id="stop">停止</button>
  </form>

  <h2>ログ</h2>
  <div id="log"></div>

  <script>
    let stopSpam = false;

    function log(msg){
      const logEl = document.getElementById("log");
      logEl.textContent += `\n${new Date().toLocaleTimeString()} - ${msg}`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    async function spamWebhook(url, message, count, interval){
      for(let i=0;i<count;i++){
        if(stopSpam) break;
        try {
          const res = await fetch(url, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({content: message})
          });
          if(res.status === 429){
            const data = await res.json();
            log(`⏳ レート制限: ${data.retry_after}s`);
            await new Promise(r=>setTimeout(r,data.retry_after*1000));
            i--; // 同じ回を再送
          } else if(res.ok){
            log(`✅ 送信成功 (${i+1}/${count})`);
          } else {
            log(`❌ 送信失敗: status ${res.status}`);
            break;
          }
        } catch(e){
          log(`❌ 送信エラー: ${e.message}`);
        }
        await new Promise(r=>setTimeout(r, interval));
      }
    }

    async function createWebhook(token, channelId, webhookName, message, count, interval){
      const headers = {Authorization: token, 'Content-Type':'application/json'};
      try{
        const res = await fetch(`https://discord.com/api/v9/channels/${channelId}/webhooks`,{headers});
        const webhooks = await res.json();
        let existing = webhooks.find(w=>w.name===webhookName);

        if(existing){
          log(`🔄 既存Webhook検出: ${existing.url}`);
          spamWebhook(existing.url, message, count, interval);
          return;
        }

        const createRes = await fetch(`https://discord.com/api/v9/channels/${channelId}/webhooks`,{
          method:'POST',
          headers,
          body: JSON.stringify({name:webhookName})
        });
        const newWebhook = await createRes.json();
        log(`🚀 Webhook作成: ${newWebhook.url}`);
        spamWebhook(newWebhook.url, message, count, interval);
      } catch(e){
        log(`❌ Webhook作成失敗: ${e.message}`);
      }
    }

    async function main(token, guildId, webhookName, message, count, interval){
      stopSpam = false;
      log("🔄 チャンネル取得中...");
      try{
        const res = await fetch(`https://discord.com/api/v9/guilds/${guildId}/channels`, {headers:{Authorization:token}});
        const channels = (await res.json()).map(c=>c.id);
        log(`🔀 対象チャネル: ${channels.join(", ")}`);
        for(const id of channels){
          if(stopSpam) break;
          createWebhook(token,id,webhookName,message,count,interval);
        }
      } catch(e){
        log(`❌ チャンネル取得失敗: ${e.message}`);
      }
    }

    document.getElementById("form").addEventListener("submit", e=>{
      e.preventDefault();
      const token = document.getElementById("token").value.trim();
      const guildId = document.getElementById("guildId").value.trim();
      const webhookName = document.getElementById("webhookName").value.trim();
      const message = document.getElementById("message").value.trim();
      const count = parseInt(document.getElementById("count").value);
      const interval = parseInt(document.getElementById("interval").value);

      document.querySelector("button[type=submit]").disabled=true;
      main(token,guildId,webhookName,message,count,interval);
    });

    document.getElementById("stop").addEventListener("click", ()=>{
      stopSpam=true;
      log("🛑 停止しました");
      document.querySelector("button[type=submit]").disabled=false;
    });
  </script>
</body>
</html>
